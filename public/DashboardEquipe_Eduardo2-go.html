<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Página Operário | Staff Watch</title>
    <link rel="stylesheet" href="./css/dashboard-eduardo.css">
    <script src="js/script.js" defer></script>
    <link rel="shortcut icon" href="./src/img/logoB.png" type="image/x-icon" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
        integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body>
    <header>
        <div class="opcoes">
            <div class="esq">
                <div class="logo">
                    <img href="index.html" src="./src/img/logoB.png" alt="logo">
                </div>
                <div class="opcoesComponentes" id="itens">
                    <h6 class="opcoesMenu" onclick="levarParaDashboard()">Home</h6>
                    <h6 class="opcoesMenu slct associMenu" onclick="abrirMenu()">Associados <img
                            src="./src/img/icons/seta.png" alt="icone menu vertical"></h6>
                    <h6 class="opcoesMenu" onclick="window.location.href='cadastroFuncionario.html'">Cadastrar</h6>
                    <div id="menu">
                        <h4 onclick="window.location.href='pagina-operario2.html'">Funcionários</h4>
                        <h4 onclick="window.location.href='pagina-maquina.html'">Dispositivos</h4>
                        <h4 onclick="window.location.href='cadastroEquipe.html'">Equipe</h4>
                    </div>
                </div>
            </div>
            <div class="sair">
                <h6 class="opcoesMenu sair" onclick="sair()"> Sair </h6>
            </div>
        </div>
    </header>
    <div class="pai">
        <button class="open-btn" onclick="openMenu()">☰</button>

        <div id="sideMenu" class="side-menu">
            <button class="close-btn" onclick="closeMenu()">☰</button>
            <div class="menuLateral">
                <div class="itens">
                    <h4 id="home" class="historico" onclick="window.location.href='dashboardPedroPorfirio.html'">Home
                    </h4>
                    <!-- Aqui as equipes serão inseridas dinamicamente pelo JavaScript -->
                    <h4 id="novaEquipe" class="novaequipe" onclick="window.location.href='./novaEquipe.html'">Nova
                        Equipe</h4>
                </div>
            </div>
        </div>
        <div>
            <h1 class="TITULO">Monitoramento da equipe</h1>
            <div class="Dashboard-chamada">
                <div class="son6">
                    <div class="bloco3">Tempo médio chamada:
                        <div class="minibloco"></div>
                    </div>

                    <div class="bloco4">Tempo médio espera:
                        <div class="minibloco1"></div>
                    </div>
                    <div class="bloco5">Eficiência:
                        <div class="minibloco2"></div>
                    </div>

                    <div class="bloco6">Chamadas perdida:
                        <div class="minibloco3"></div>
                    </div>
                </div>
            </div>
            <article class="title">

                <input type="text" name="Pesquisar" id="pesquisar_input" required="required" autocomplete="off"
                    placeholder="Pesquisar funcionário"><button onclick="listarPorUsuario()" id="listar"><i
                        class="fa-solid fa-magnifying-glass"></i></button>
            </article>
            <br>
            <br>
            <div class="funcs">
                <div id="feed_container" class="feed-container"></div>
            </div>
        </div>
        <!-- Modal -->
        <!-- Modal -->
        <!-- Modal -->
        <div id="fade" class="hide"></div>
        <div id="modal" class="hide">
            <div class="modal-content">
                <!-- Títulos no topo -->
                <div id="modal-titles" class="opcoesComponentes">
                    <h6 class="opcoesMenu" id="cpu" onclick="puxarTempoChamada()">Tempo médio</h6>
                    <h6 class="opcoesMenu" id="disco" onclick="puxarDadosChamada()">Tempo médio espera</h6>
                    <h6 class="opcoesMenu" id="rede" onclick="eficienciaChamada()">Eficiência</h6>
                    <h6 class="opcoesMenu" id="memoria" onclick="puxarTotalPerdida()">Chamadas perdidas</h6>

                </div>

                <!-- Gráfico no meio -->
                <div class="grafico">
                    <canvas id="MyChart" style="height: 175px;"></canvas>
                    <button id="btn_novo_grafico" onclick="carregarNovaDashboard()"></button>

                    <!-- <canvas id="graficoEspera"></canvas>
                        <canvas id="graficoEficiencia"></canvas>
                        <canvas id="graficoPerdida"></canvas> -->
                </div>

                <!-- Corpo do modal -->
                <div id="modal-body"></div>

                <!-- Botão de fechar -->
                <button onclick="fecharModal()" id="botaoSaida">Fechar</button>
            </div>
        </div>

        <div class="alerta">
            <h1>Alertas</h1>
            <!-- <div class="bloco7" id="cardAlerta1"></div>
            <div class="bloco8" id="cardAlerta2"></div> -->
        </div>
    </div>
</body>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</html>

<script>
    function abrirMenu() {
        if (document.getElementById("menu").style.display == "flex") {
            document.getElementById("menu").style.display = "none";
        } else {
            document.getElementById("menu").style.display = "flex"
        }
    }
    function openMenu() {
        document.getElementById("sideMenu").style.left = "0";
    }

    // Função para fechar o menu
    function closeMenu() {
        document.getElementById("sideMenu").style.left = "-250px";
    }

    var fkCargo = sessionStorage.FK_CARGO;

    function sair() {
        sessionStorage.clear()
        window.location = "index.html"
    }

    let idFuncionarioSelecionado;
    // const fkEquipe = sessionStorage.getItem("equipeSelecionada");
    const fkEquipe = 1

    function atualizarFeedEquipe() {
        const fkEmpresa = sessionStorage.getItem("ID_EMPRESA");
        const fkEquipe = sessionStorage.getItem("equipeSelecionada");

        fetch(`/funcionarios/listarEquipe/${fkEmpresa}/${fkEquipe}`)
            .then(resposta => {
                if (resposta.ok) {
                    return resposta.json();
                } else if (resposta.status === 204) {
                    const feed = document.getElementById("feed_container");
                    feed.innerHTML = "<span>Nenhum resultado encontrado.</span>";
                    throw new Error("Nenhum resultado encontrado.");
                } else {
                    throw new Error("Erro ao buscar funcionários.");
                }
            })
            .then(resposta => {
                const feed = document.getElementById("feed_container");
                feed.innerHTML = "";

                resposta.forEach(funcionario => {
                    const divPublicacao = document.createElement("div");
                    divPublicacao.className = "publicacao";
                    divPublicacao.innerHTML = `
                    <span><b>ID Funcionário:</b> ${funcionario.idFuncionario}</span>
                    <span><b>Nome:</b> ${funcionario.nome}</span>
                    <span><b>E-mail:</b> ${funcionario.email}</span>
                    <span><b>Equipe:</b> ${funcionario.fkEquipe}</span>
                `;
                    divPublicacao.addEventListener("click", () => abrirModal(funcionario.idFuncionario));
                    feed.appendChild(divPublicacao);
                });
            })
            .catch(console.error);
    }

    function abrirModal(idFuncionario) {

        idFuncionarioSelecionado = idFuncionario;
        console.log(idFuncionarioSelecionado);
        console.log("------");

        const fade = document.getElementById("fade");
        const modal = document.getElementById("modal");

        fade.classList.remove("hide");
        fade.classList.add("show");
        modal.classList.remove("hide");
        modal.classList.add("show");

        // Exibe informações iniciais no modal (tempo médio de chamada)
        puxarTempoChamada(idFuncionarioSelecionado)
    }

    function fecharModal() {
        const fade = document.getElementById("fade");
        const modal = document.getElementById("modal");

        fade.classList.remove("show");
        fade.classList.add("hide");
        modal.classList.remove("show");
        modal.classList.add("hide");
    }


    // Event Listeners para os botões
    // document.querySelector(".bloco3").addEventListener("click", () => {
    //     carregarGrafico("Tempo Médio de Atendimento", "tempoChamada");
    // });

    // document.querySelector(".bloco4").addEventListener("click", () => {
    //     carregarGrafico("Tempo Médio de Espera", "tempoEspera");
    // });

    // document.querySelector(".bloco5").addEventListener("click", () => {
    //     carregarGrafico("Eficiência", "eficiencia");
    // });

    // document.querySelector(".bloco6").addEventListener("click", () => {
    //     carregarGrafico("Chamadas Perdidas", "totalPerdida");
    // });



    function levarParaDashboard() {
        if (fkCargo == 3) {
            window.location.href = "/dashboardGeral-gti.html";
        } else if (fkCargo == 2) {
            window.location.href = "/dashboardPedroPorfirio.html";
        } else {
            window.location.href = "/dashboardPedroPorfirio.html";

        }

    }

    function redirecionarParaEdicao(idFuncionario) {
        // Redireciona o usuário para a página de edição com o ID do funcionário como parâmetro na URL
        window.location.href = `editarFuncionario.html?id=${idFuncionario}`;
    }

    function deletar(idFuncionario) {
        if (confirm("Tem a certeza de que deseja deletar este funcionário?")) {
            fetch(`/funcionarios/deletar/${idFuncionario}`, {
                method: "get"
            })
                .then(resposta => {
                    if (resposta.ok) {
                        // alert("Funcionário deletado com sucesso!");
                        atualizarFeed(); // Atualiza a lista após a exclusão
                    } else {
                        throw "Não foi possível deletar o funcionário.";
                    }
                })
                .catch(error => {
                    console.error(error);
                    // alert("Ocorreu um erro ao tentar deletar o funcionário.");
                });
        }
    }

    function puxarDadosChamada(idFunc = idFuncionarioSelecionado) {
        console.log(idFunc)

        const alertaContainer = document.querySelector(".alerta"); // Seleciona a div alerta

        const modalBody = document.getElementById("modal-body");
        modalBody.innerHTML = "Carregando gráfico...";

        // Limpa qualquer gráfico anterior
        if (window.myChart) {
            window.myChart.destroy();
        }

        fetch(`/funcionarios/dados/tempoEspera/${idFunc}`, { method: "GET" })
            .then(resposta => {
                if (!resposta.ok) {
                    throw new Error("Não foi possível capturar os dados do funcionário.");
                }
                return resposta.json(); // Processa os dados como JSON
            })
            .then(dados => {
                console.log("Dados recebidos:", dados);

                // Verifica se os dados existem
                if (!dados || dados.length === 0) {
                    modalBody.innerHTML = "Nenhum dado disponível para este gráfico.";
                    return;
                }

                // Assume que 'dados' é um array de objetos com propriedade 'tempoChamada'
                const labels = dados.map((_, index) => `Chamada ${index + 1}`);
                const data = dados.map(funcionario => funcionario.tempoEspera);

                // Calcula o tempo médio
                const tempoTotal = data.reduce((soma, tempo) => soma + tempo, 0);
                const tempoMedio = (tempoTotal / data.length).toFixed(2);
                const tempoCorreto = tempoMedio - 1732087490
                // Exibe o tempo médio no modal
                modalBody.innerHTML = `<p>Tempo médio de espera até a chamada ser atendida: ${tempoCorreto.toFixed(2)}s</p>`;

                if (tempoCorreto >= 72) {

                    // Cria um novo "card" de alerta
                    const novoCard = document.createElement("div");
                    novoCard.className = "bloco7"; // Classe para o novo card
                    novoCard.id = `cardAlerta`; // ID único baseado no funcionário

                    // Define o conteúdo do card
                    novoCard.innerHTML = `
                <p>Funcionário ${idFunc} está com uma média de tempo de espera alta.</p>
                
                `;
                    let textoTempoEspera = `<p style="color: red;">Tempo médio de Espera: ${tempoCorreto.toFixed(2)}s</p>`;
                    modalBody.innerHTML = textoTempoEspera;

                    // Adiciona o novo card à div de alertas
                    alertaContainer.appendChild(novoCard);

                }

                // Cria o filtro acima do gráfico
                const filtroContainer = document.createElement("div");
                filtroContainer.id = "filtro-espera";
                filtroContainer.style.marginLeft = "40px";
                filtroContainer.innerHTML = `
                <input type="date" id="dataFiltro" />
                <button class="btn-filtrar" onclick="filtrarTempoEspera()">Filtrar</button>
            `;
                modalBody.appendChild(filtroContainer);
                // Configura o gráfico
                const ctx = document.getElementById("MyChart").getContext("2d");
                window.myChart = new Chart(ctx, {
                    type: "bar",
                    data: {
                        labels: labels,
                        datasets: [{
                            label: "Tempo de Espera (s)",
                            data: data,
                            backgroundColor: "rgba(0, 33, 72, 0.8)",
                            borderColor: "rgba(0, 33, 72, 1)",
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            })
            .catch(erro => {
                console.error("Erro ao carregar os dados:", erro);
                modalBody.innerHTML = "Erro ao carregar os dados. Tente novamente.";
            });
    }

    function puxarTempoChamada(idFunc = idFuncionarioSelecionado) {
        console.log(idFunc);

        const alertaContainer = document.querySelector(".alerta"); // Seleciona a div alerta
        const modalBody = document.getElementById("modal-body");
        modalBody.innerHTML = "Carregando gráfico...";

        // Limpa qualquer gráfico anterior
        if (window.myChart) {
            window.myChart.destroy();
        }

        fetch(`/funcionarios/dados/tempoChamada/${idFunc}`, { method: "GET" })
            .then(resposta => {
                if (!resposta.ok) {
                    throw new Error("Não foi possível capturar os dados do funcionário.");
                }
                return resposta.json(); // Processa os dados como JSON
            })
            .then(dados => {
                console.log("Dados recebidos:", dados);

                // Verifica se os dados existem
                if (!dados || dados.length === 0) {
                    modalBody.innerHTML = "Nenhum dado disponível para este gráfico.";
                    return;
                }

                // Assume que 'dados' é um array de objetos com propriedade 'tempoChamada'
                const labels = dados.map((_, index) => `Chamada ${index + 1}`);
                const data = dados.map(funcionario => funcionario.tempoChamada);

                // Calcula o tempo médio
                const tempoTotal = data.reduce((soma, tempo) => soma + tempo, 0);
                const tempoMedio = (tempoTotal / data.length).toFixed(2);

                // Exibe o tempo médio no modal
                modalBody.innerHTML = `<p>Tempo médio de chamada: ${tempoMedio}s</p>`;

                if (tempoMedio >= 420) {
                    // Cria um novo "card" de alerta
                    const novoCard = document.createElement("div");
                    novoCard.className = "bloco7"; // Classe para o novo card
                    novoCard.id = `cardAlerta`; // ID único baseado no funcionário

                    // Define o conteúdo do card
                    novoCard.innerHTML = `
                    <p>Funcionário ${idFunc} está com uma média de chamada alta.</p>
                `;
                    let textoTempoChamada = `<p style="color: red;">Tempo médio de chamada: ${tempoMedio}s</p>`;
                    modalBody.innerHTML = textoTempoChamada;

                    // Adiciona o novo card à div de alertas
                    alertaContainer.appendChild(novoCard);
                }

                // Cria o filtro acima do gráfico
                const filtroContainer = document.createElement("div");
                filtroContainer.id = "filtro-chamada";
                filtroContainer.innerHTML = `
                <input type="date" id="dataFiltro" />
                <button class="btn-filtrar" onclick="filtrarTempoChamada()">Filtrar</button>
            `;
                modalBody.appendChild(filtroContainer);

                // Configura o gráfico
                const ctx = document.getElementById("MyChart").getContext("2d");
                window.myChart = new Chart(ctx, {
                    type: "bar",
                    data: {
                        labels: labels,
                        datasets: [{
                            label: "Tempo de Chamada (s)",
                            data: data,
                            backgroundColor: "rgba(0, 33, 72, 0.8)",
                            borderColor: "rgba(0, 33, 72, 1)",
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            })
            .catch(erro => {
                console.error("Erro ao carregar os dados:", erro);
                modalBody.innerHTML = "Erro ao carregar os dados. Tente novamente.";
            });
    }




    function puxarTotalChamada(idFuncionario) {

        fetch(`/funcionarios/dados/totalChamada/${1}`, {
            method: "GET"
        })
            .then(resposta => {
                if (resposta.ok) {
                    console.log(resposta)
                        // alert("Captura de dados total de chamadas efetuadas ");
                        ; // Atualiza a lista após a exclusão
                } else {
                    throw "Não foi possível capturar o total de chamadas do funcionário.";
                }
            })
            .catch(error => {
                console.error(error);
                // alert("Ocorreu um erro ao tentar capturar o total de chamadas do funcionário");
            });
    }


    function puxarTotalPerdida(idFunc = idFuncionarioSelecionado) {
        console.log(idFunc);
        const alertaContainer = document.querySelector(".alerta"); // Seleciona a div alerta
        const modalBody = document.getElementById("modal-body");
        modalBody.innerHTML = "Carregando gráfico...";

        // Limpa qualquer gráfico anterior
        if (window.myChart) {
            window.myChart.destroy();
        }

        fetch(`/funcionarios/dados/totalPerdida/${idFunc}`, {
            method: "GET"
        })
            .then(resposta => resposta.json())  // Garante que a resposta seja tratada como JSON
            .then(dados => {
                console.log("Dados recebidos:", dados);

                // Verifica se os dados existem
                if (!dados || dados.length === 0) {
                    modalBody.innerHTML = "Nenhum dado disponível para este gráfico.";
                    return;
                }

                // Acessa as chamadas perdidas e recebidas diretamente do objeto
                const chamadasRecebidas = dados[0].chamadasRecebidas;
                const chamadasPerdidas = dados[0].chamadasPerdidas;

                // Calcula a porcentagem de chamadas perdidas
                const totalChamadas = chamadasRecebidas + chamadasPerdidas;
                const porcentagemPerdida = ((chamadasPerdidas / totalChamadas) * 100).toFixed(2);

                // Atualiza o modal com o texto da porcentagem
                let textoPorcentagem = `<p>Total de chamadas perdidas: ${porcentagemPerdida}%</p>`;
                modalBody.innerHTML = textoPorcentagem;

                // Verifica se a porcentagem perdida é maior ou igual a 20%
                if (porcentagemPerdida >= 6) {
                    // Cria um novo "card" de alerta
                    const novoCard = document.createElement("div");
                    novoCard.className = "bloco7"; // Classe para o novo card
                    novoCard.id = `cardAlerta`; // ID único baseado no funcionário

                    // Define o conteúdo do card
                    novoCard.innerHTML = `
                <p>Funcionário ${idFunc} está com uma alta porcentagem de chamadas perdidas.</p>
                
                `;
                    let textoPorcentagem = `<p style="color: red;">Porcentagem de chamadas perdidas: ${porcentagemPerdida}%</p>`;
                    modalBody.innerHTML = textoPorcentagem;

                    // Adiciona o novo card à div de alertas
                    alertaContainer.appendChild(novoCard);
                }

                const filtroContainer = document.createElement("div");
                filtroContainer.id = "filtro-espera";
                filtroContainer.style.marginLeft = "40px";
                filtroContainer.innerHTML = `
                <input type="date" id="dataFiltro" />
                <button class="btn-filtrar" onclick="filtrarPerdida()">Filtrar</button>
            `;
                modalBody.appendChild(filtroContainer);
                // Cria o gráfico de barras
                const ctx = document.getElementById("MyChart").getContext("2d");
                window.myChart = new Chart(ctx, {
                    type: "bar",
                    data: {
                        labels: ["Chamadas Recebidas", "Chamadas Perdidas"],
                        datasets: [{
                            label: "Número de Chamadas",
                            data: [chamadasRecebidas, chamadasPerdidas],
                            backgroundColor: [
                                "rgba(0, 33, 72, 0.8)", // Cor para chamadas recebidas
                                "rgba(43, 99, 132, 0.8)" // Cor para chamadas perdidas
                            ],
                            borderColor: [
                                "rgba(0, 33, 72, 1)",
                                "rgba(43, 99, 132, 0.8)"
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            })
            .catch(erro => {
                console.error("Erro ao carregar os dados:", erro);
                modalBody.innerHTML = "Erro ao carregar os dados. Tente novamente.";
            });
    }


    function puxarTotalAtendida(idFuncionario) {

        fetch(`/funcionarios/dados/totalAtendida/${1}`, {
            method: "GET"
        })
            .then(resposta => {
                if (resposta.ok) {
                    console.log(resposta)
                        //  alert("Captura de dados total de chamadas atendida efetuadas ");
                        ; // Atualiza a lista após a exclusão
                } else {
                    throw "Não foi possível capturar o total de chamadas atendidas do funcionário.";
                }
            })
            .catch(error => {
                console.error(error);
                //  alert("Ocorreu um erro ao tentar capturar o total de chamadas atendidas do funcionário");
            });
    }


    function eficienciaChamada(idFunc = idFuncionarioSelecionado) {
        console.log(idFunc)
        const alertaBody = document.getElementById("cardAlerta2")
        const alertaContainer = document.querySelector(".alerta");
        console.log(idFuncionarioSelecionado)
        const modalBody = document.getElementById("modal-body");
        modalBody.innerHTML = "Carregando gráfico..."; // Exibe a mensagem de carregamento

        // Limpa qualquer gráfico anterior
        if (window.myChart) {
            window.myChart.destroy();
        }


        // Busca os dados de eficiência de chamadas
        fetch(`/funcionarios/dados/eficiencia/${idFunc}`, {
            method: "GET"
        })
            .then(resposta => resposta.json())  // Garante que a resposta seja tratada como JSON
            .then(dados => {
                console.log("Dados recebidos:", dados);

                // Verifica se os dados existem
                if (!dados || dados.length === 0) {
                    modalBody.innerHTML = "Nenhum dado disponível para este gráfico.";
                    return;
                }

                // Acessa as chamadas recebidas e atendidas diretamente do objeto
                const chamadasRecebidas = dados[0].chamadaRecebida;
                const chamadasAtendidas = dados[0].chamadaAtendida;
                console.log(chamadasRecebidas)
                console.log(chamadasAtendidas)

                // Calcula a eficiência
                const eficiencia = (chamadasAtendidas / chamadasRecebidas) * 100;

                // Exibe a eficiência no modal


                if (eficiencia <= 70) {
                    // Cria um novo "card" de alerta
                    const novoCard = document.createElement("div");
                    novoCard.className = "bloco7"; // Classe para o novo card
                    novoCard.id = `cardAlerta`; // ID único baseado no funcionário

                    // Define o conteúdo do card
                    novoCard.innerHTML = `
                <p>Funcionário ${1} está com uma baixa eficiência.</p>
                
                `;
                    let textoEficiencia = `<p style="color: red;">Porcentagem de eficiência: ${eficiencia.toFixed(2)}%</p>`;
                    modalBody.innerHTML = textoEficiencia;

                    // Adiciona o novo card à div de alertas
                    alertaContainer.appendChild(novoCard);
                } else {
                    let textoEficiencia = `<p>Eficiência de chamadas: ${eficiencia.toFixed(2)}%</p>`;
                    modalBody.innerHTML = textoEficiencia;
                }

                // Cria o filtro acima do gráfico
                const filtroContainer = document.createElement("div");
                filtroContainer.id = "filtro-chamada";
             
                filtroContainer.innerHTML = `
                <input type="date" id="dataFiltro" />
                <button class="btn-filtrar" onclick="filtrarEficiencia()">Filtrar</button>
            `;
                modalBody.appendChild(filtroContainer);


                // Cria o gráfico de barras
                const ctx = document.getElementById("MyChart").getContext("2d");
                window.myChart = new Chart(ctx, {
                    type: "bar", // Tipo do gráfico (barras)
                    data: {
                        labels: ["Chamadas Recebidas", "Chamadas Atendidas"], // Labels para as barras
                        datasets: [{
                            label: "Eficiência de Chamadas", // Rótulo para a legenda
                            data: [chamadasRecebidas, chamadasAtendidas], // Dados das chamadas
                            backgroundColor: [
                                "rgba(0, 33, 72, 0.8)", // Cor para chamadas recebidas
                                "rgba(43, 99, 132, 0.8)" // Cor para chamadas atendidas
                            ],
                            borderColor: [
                                "rgba(0, 33, 72, 1)", // Borda para chamadas recebidas
                                "rgba(43, 99, 132, 1)" // Borda para chamadas atendidas
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true // Garante que o eixo Y comece do zero
                            }
                        }
                    }
                });
            })
            .catch(erro => {
                console.error("Erro ao carregar os dados:", erro);
                modalBody.innerHTML = "Erro ao carregar os dados. Tente novamente."; // Exibe a mensagem de erro
            });
    }





    // equipe


    function puxarDadosEquipeChamada(fkEquipe) {

        fetch(`/funcionarios/dados/tempoEspera/${1}`, {
            method: "GET"
        })
            .then(resposta => {
                if (resposta.ok) {
                    return resposta.json(); // Retorna os dados em JSON
                } else {
                    throw new Error("Não foi possível capturar os dados de tempo de espera do funcionário.");
                }
            })
            .then(data => {
                if (data && Array.isArray(data)) { // Valida se 'data' é um array
                    const tempoTotalEspera = data.reduce((soma, funcionario) => soma + funcionario.tempoEspera, 0);
                    const tempoMedioEspera = (tempoTotalEspera / data.length).toFixed(2);
                    const tempoCorreto = tempoTotalEspera - 136834912170; // Cálculo médio e arredondamento
                    document.querySelector('.minibloco1').textContent = `${tempoCorreto.toFixed(2)}s`; // Atualiza a UI
                } else {
                    throw new Error("Dados inesperados recebidos do servidor.");
                }
            })
            .catch(error => {
                console.error("Erro:", error.message);
                document.querySelector('.minibloco').textContent = "Erro ao carregar dados."; // Feedback para o utilizador
            });
    }

    function puxarTempoEquipeChamada(fkEquipe) {
        console.log("-")
        console.log(fkEquipe)
        fetch(`/funcionarios/dados/tempoChamada/${1}`, {
            method: "GET"
        })
            .then(resposta => {
                if (resposta.ok) {
                    return resposta.json(); // Retorna os dados em JSON
                } else {
                    throw new Error("Não foi possível capturar os dados do funcionário.");
                }
            })
            .then(data => {
                if (data && Array.isArray(data)) { // Valida se 'data' é um array
                    const tempoTotal = data.reduce((soma, funcionario) => soma + funcionario.tempoChamada, 0);
                    const tempoMedio = (tempoTotal / data.length).toFixed(2); // Cálculo médio e arredondamento
                    document.querySelector('.minibloco').textContent = `${tempoMedio}s`; // Atualiza a UI
                } else {
                    throw new Error("Dados inesperados recebidos do servidor.");
                }
            })
            .catch(error => {
                console.error("Erro:", error.message);
                document.querySelector('.minibloco').textContent = "Erro ao carregar dados."; // Feedback para o utilizador
            });
    }



    function puxarTotalEquipeChamada(fkEquipe) {

        fetch(`/funcionarios/dados/totalChamada/${1}`, {
            method: "GET"
        })
            .then(resposta => {
                if (resposta.ok) {
                    console.log(resposta)
                        // alert("Captura de dados total de chamadas efetuadas ");
                        ; // Atualiza a lista após a exclusão
                } else {
                    throw "Não foi possível capturar o total de chamadas do funcionário.";
                }
            })
            .catch(error => {
                console.error(error);
                // alert("Ocorreu um erro ao tentar capturar o total de chamadas do funcionário");
            });
    }


    function puxarTotalEquipePerdida(fkEquipe) {
    fetch(`/funcionarios/dados/totalPerdida/${1}`, {
        method: "GET"
    })
        .then(resposta => {
            if (resposta.ok) {
                return resposta.json(); // Retorna os dados em JSON
            } else {
                throw new Error("Não foi possível capturar os dados de chamadas perdidas da equipe.");
            }
        })
        .then(data => {
            console.log("Dados recebidos:", data); // Log para verificar o formato dos dados

            // Verifica se o array 'data' não está vazio
            if (Array.isArray(data) && data.length > 0) {

                console.log(data)
                console.log("----------a")
                const totalChamadasRecebidas = data[0].chamadasRecebidas;
                const totalChamadasPerdidas = data[0].chamadasPerdidas;

                // Calcula a porcentagem de chamadas perdidas
                const totalChamadas = totalChamadasRecebidas + totalChamadasPerdidas;
                const porcentagemPerdidas = totalChamadas > 0
                    ? ((totalChamadasPerdidas / totalChamadas) * 100).toFixed(2)
                    : 0;

                // Atualiza o conteúdo da interface com os valores
                document.querySelector('.minibloco3').textContent = `
                    ${porcentagemPerdidas} %
                `;
            } else {
                throw new Error("Formato inesperado dos dados recebidos.");
            }
        })
        .catch(error => {
            console.error("Erro:", error.message);
            document.querySelector('.minibloco3').textContent = "Erro ao carregar dados."; // Feedback para o utilizador
        });
}



    function eficienciaEquipeChamada(fkEquipe) {
        fetch(`/funcionarios/dados/eficiencia/${1}`, {
            method: "GET"
        })
            .then(resposta => {
                if (resposta.ok) {
                    return resposta.json(); // Retorna os dados em JSON
                } else {
                    throw new Error("Não foi possível capturar os dados de chamadas perdidas da equipe.");
                }
            })
            .then(data => {
                console.log("Dados recebidos:", data); // Verifica o formato dos dados

                // Caso os dados sejam um array de objetos
                if (Array.isArray(data) && data.length > 0) {
                    // Acessa o primeiro item do array
                    const chamadas = data[0];

                    // Verifica se as propriedades existem no primeiro objeto
                    if (chamadas.chamadaRecebida !== undefined && chamadas.chamadaAtendida !== undefined) {
                        const totalChamadas = chamadas.chamadaRecebida;
                        const totalChamadasAtendidas = chamadas.chamadaAtendida;

                        // Garantir que os valores são válidos antes de realizar o cálculo
                        if (totalChamadas > 0) {
                            const eficiencia = (totalChamadasAtendidas / totalChamadas) * 100; // Calcula a eficiência
                            document.querySelector('.minibloco2').textContent = `${eficiencia.toFixed(2)}%`; // Exibe a eficiência formatada
                        } else {
                            document.querySelector('.minibloco2').textContent = "Não há chamadas registradas."; // Caso não haja chamadas
                        }
                    } else {
                        throw new Error("Formato inesperado dos dados recebidos: propriedades ausentes.");
                    }
                } else {
                    throw new Error("Formato inesperado dos dados recebidos: dados não são um array.");
                }
            })
            .catch(error => {
                console.error("Erro:", error.message);
                document.querySelector('.minibloco2').textContent = `Erro ao carregar dados: ${error.message}`; // Exibe o erro detalhado
            });
    }





    function puxarTotalEquipeAtendida(fkEquipe) {

        fetch(`/funcionarios/dados/totalAtendida/${1}`, {
            method: "GET"
        })
            .then(resposta => {
                if (resposta.ok) {
                    console.log(resposta)
                        //  alert("Captura de dados total de chamadas atendida efetuadas ");
                        ; // Atualiza a lista após a exclusão
                } else {
                    throw "Não foi possível capturar o total de chamadas atendidas do funcionário.";
                }
            })
            .catch(error => {
                console.error(error);
                //  alert("Ocorreu um erro ao tentar capturar o total de chamadas atendidas do funcionário");
            });
    }


    function listarPorUsuario() {
        const inputPesquisa = document.getElementById("pesquisar_input").value; // Pega o valor do input
        const fkEmpresa = sessionStorage.getItem("ID_EMPRESA");
        console.log(fkEmpresa)

        // Faz uma requisição à API, passando o termo de pesquisa
        fetch(`/funcionarios/listar/${fkEmpresa}/${inputPesquisa}`).then(function (resposta) {
            if (resposta.ok) {
                if (resposta.status == 204) {
                    const feed = document.getElementById("feed_container");
                    feed.innerHTML = "Nenhum resultado encontrado.";
                    return;
                }

                resposta.json().then(function (resposta) {
                    const feed = document.getElementById("feed_container");
                    feed.innerHTML = ""; // Limpa o conteúdo atual do feed

                    resposta.forEach((publicacao) => {
                        const divPublicacao = document.createElement("div");
                        const spanID = document.createElement("span");
                        const spanTitulo = document.createElement("span");
                        const spanNome = document.createElement("span");
                        const divDescricao = document.createElement("div");
                        const divButtons = document.createElement("div");
                        const btnEditar = document.createElement("button");
                        const btnDeletar = document.createElement("button");

                        spanID.innerHTML = "<div class='id'> Id Funcionário: <b>" + publicacao.idFuncionario + "</b> </div> <br>";
                        spanTitulo.innerHTML = "E-mail: <b>" + publicacao.email + "</b>";
                        spanNome.innerHTML = "Nome: <b>" + publicacao.nome + "</b>";
                        divDescricao.innerHTML = "Equipe: <b>" + publicacao.fkEquipe + "</b>";

                        btnEditar.innerHTML = '<i class="fa-solid fa-pen"></i>';
                        btnEditar.className = "editar";
                        btnEditar.id = "AbrirModal2_" + publicacao.idFuncionario;
                        btnEditar.addEventListener('click', function () {
                            redirecionarParaEdicao(publicacao.idFuncionario);
                        });

                        btnDeletar.innerHTML = '<i class="fa-solid fa-trash"></i>';
                        btnDeletar.className = "deletar";
                        btnDeletar.id = "btnDeletar_" + publicacao.idFuncionario;
                        btnDeletar.addEventListener('click', function () {
                            deletar(publicacao.idFuncionario);
                        });

                        divButtons.className = "div-buttons";
                        divButtons.appendChild(btnEditar);
                        divButtons.appendChild(btnDeletar);

                        divPublicacao.className = "publicacao";
                        divPublicacao.appendChild(spanID);
                        divPublicacao.appendChild(spanNome);
                        divPublicacao.appendChild(spanTitulo);
                        divPublicacao.appendChild(divDescricao);
                        divPublicacao.appendChild(divButtons);

                        feed.appendChild(divPublicacao);
                    });
                });
            } else {
                console.error("Houve um erro na API.");
            }
        }).catch(function (erro) {
            console.error("Erro na requisição:", erro);
        });
    }

    function listarEquipes() {
        const fkEmpresa = sessionStorage.getItem("ID_EMPRESA");

        fetch(`funcionarios/listarEquipes/${fkEmpresa}`)
            .then(resposta => {
                if (resposta.ok) {
                    return resposta.json(); // Se a resposta for válida, converte para JSON
                } else {
                    console.error("Erro ao carregar equipes, status:", resposta.status);
                    return [];
                }
            })
            .then(dados => {
                console.log("Equipes carregadas:", dados);

                const menuLateral = document.querySelector(".menuLateral .itens");
                const historicoItem = document.querySelector("#home");
                const novaEquipeItem = document.querySelector("#novaEquipe");

                // Limpa o menu e reinsere os itens fixos
                menuLateral.innerHTML = '';
                menuLateral.appendChild(historicoItem);

                if (dados.length > 0) {
                    dados.forEach(equipe => {
                        const h4 = document.createElement("h4");
                        h4.textContent = equipe.nome;
                        h4.classList.add("equipe"); // Classe para estilização

                        // Redireciona ao clicar na equipe
                        h4.onclick = () => {
                            window.location.href = `DashboardEquipe_Eduardo2-go.html?id=${equipe.id}&nome=${encodeURIComponent(equipe.nome)}`;
                        };

                        menuLateral.appendChild(h4);
                    });
                } else {
                    const noTeamsMessage = document.createElement("h4");
                    noTeamsMessage.textContent = "Nenhuma equipe encontrada.";
                    noTeamsMessage.classList.add("sem-equipes");
                    menuLateral.appendChild(noTeamsMessage);
                }

                // Reinsere o item "Nova Equipe"
                menuLateral.appendChild(novaEquipeItem);
            })
            .catch(erro => {
                console.error("Erro ao carregar as equipes:", erro);
            });
    }


    function filtrarTempoChamada(idFunc = idFuncionarioSelecionado) {

        const dataSelecionada = document.getElementById("dataFiltro").value;


        if (dataSelecionada) {
            console.log("Data selecionada para filtrar:", dataSelecionada);
            console.log(idFunc);

            const alertaContainer = document.querySelector(".alerta"); // Seleciona a div alerta
            const modalBody = document.getElementById("modal-body");
            modalBody.innerHTML = "Carregando gráfico...";

            // Limpa qualquer gráfico anterior
            if (window.myChart) {
                window.myChart.destroy();
            }

            fetch(`/funcionarios/dados/filtro/tempoChamada/${dataSelecionada}/${idFunc}`, { method: "GET" })
                .then(resposta => {
                    if (!resposta.ok) {
                        throw new Error("Não foi possível capturar os dados do funcionário.");
                    }
                    return resposta.json(); // Processa os dados como JSON
                })
                .then(dados => {
                    console.log("Dados recebidos:", dados);

                    // Verifica se os dados existem
                    if (!dados || dados.length === 0) {
                        modalBody.innerHTML = "Nenhum dado disponível para este gráfico.";
                        return;
                    }

                    // Assume que 'dados' é um array de objetos com propriedade 'tempoChamada'
                    const labels = dados.map((_, index) => `Chamada ${index + 1}`);
                    const data = dados.map(funcionario => funcionario.tempoChamada);

                    // Calcula o tempo médio
                    const tempoTotal = data.reduce((soma, tempo) => soma + tempo, 0);
                    const tempoMedio = (tempoTotal / data.length).toFixed(2);

                    // Exibe o tempo médio no modal
                    modalBody.innerHTML = `<p>Tempo médio de chamada: ${tempoMedio}s</p>`;

                    if (tempoMedio >= 420) {
                        // Cria um novo "card" de alerta
                        const novoCard = document.createElement("div");
                        novoCard.className = "bloco7"; // Classe para o novo card
                        novoCard.id = `cardAlerta`; // ID único baseado no funcionário

                        // Define o conteúdo do card
                        novoCard.innerHTML = `
            <p>Funcionário ${idFunc} está com uma média de chamada alta.</p>
        `;
                        let textoTempoChamada = `<p style="color: red;">Tempo médio de chamada: ${tempoMedio}s</p>`;
                        modalBody.innerHTML = textoTempoChamada;

                        // Adiciona o novo card à div de alertas
                        alertaContainer.appendChild(novoCard);
                    }

                    // Cria o filtro acima do gráfico
                    const filtroContainer = document.createElement("div");
                    filtroContainer.id = "filtro-chamada";
                    filtroContainer.innerHTML = `
        <input type="date" id="dataFiltro" />
        <button class="btn-filtrar" onclick="filtrarTempoChamada()">Filtrar</button>
    `;
                    modalBody.appendChild(filtroContainer);

                    // Configura o gráfico
                    const ctx = document.getElementById("MyChart").getContext("2d");
                    window.myChart = new Chart(ctx, {
                        type: "bar",
                        data: {
                            labels: labels,
                            datasets: [{
                                label: "Tempo de Chamada (s)",
                                data: data,
                                backgroundColor: "rgba(0, 33, 72, 0.8)",
                                borderColor: "rgba(0, 33, 72, 1)",
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                })
                .catch(erro => {
                    console.error("Erro ao carregar os dados:", erro);
                    modalBody.innerHTML = "Erro ao carregar os dados. Tente novamente.";
                });

        } else {
            alert("Selecione uma data para filtrar.");
        }
    }

    function filtrarTempoEspera(idFunc = idFuncionarioSelecionado) {

        const dataSelecionada = document.getElementById("dataFiltro").value;

        if (dataSelecionada) {
            console.log("Data selecionada para filtrar:", dataSelecionada);
            console.log(idFunc);

            const alertaContainer = document.querySelector(".alerta"); // Seleciona a div alerta
            const modalBody = document.getElementById("modal-body");
            modalBody.innerHTML = "Carregando gráfico...";

            // Limpa qualquer gráfico anterior
            if (window.myChart) {
                window.myChart.destroy();
            }

            fetch(`/funcionarios/dados/filtro/tempoEspera/${dataSelecionada}/${idFunc}`, { method: "GET" })
                .then(resposta => {
                    if (!resposta.ok) {
                        throw new Error("Não foi possível capturar os dados do funcionário.");
                    }
                    return resposta.json(); // Processa os dados como JSON
                })
                .then(dados => {
                    console.log("Dados recebidos:", dados);

                    // Verifica se os dados existem
                    if (!dados || dados.length === 0) {
                        modalBody.innerHTML = "Nenhum dado disponível para este gráfico.";
                        return;
                    }

                    // Assume que 'dados' é um array de objetos com propriedade 'tempoChamada'
                    const labels = dados.map((_, index) => `Chamada ${index + 1}`);
                    const data = dados.map(funcionario => funcionario.tempoEspera);

                    // Calcula o tempo médio
                    const tempoTotal = data.reduce((soma, tempo) => soma + tempo, 0);
                    const tempoMedio = (tempoTotal / data.length).toFixed(2);
                    const tempoCorreto = tempoMedio - 1732087490
                    // Exibe o tempo médio no modal
                    modalBody.innerHTML = `<p>Tempo médio de espera até a chamada ser atendida: ${tempoCorreto.toFixed(2)}s</p>`;

                    if (tempoCorreto >= 72) {

                        // Cria um novo "card" de alerta
                        const novoCard = document.createElement("div");
                        novoCard.className = "bloco7"; // Classe para o novo card
                        novoCard.id = `cardAlerta`; // ID único baseado no funcionário

                        // Define o conteúdo do card
                        novoCard.innerHTML = `
                <p>Funcionário ${idFunc} está com uma média de tempo de espera alta.</p>
                
                `;
                        let textoTempoEspera = `<p style="color: red;">Tempo médio de Espera: ${tempoCorreto.toFixed(2)}s</p>`;
                        modalBody.innerHTML = textoTempoEspera;

                        // Adiciona o novo card à div de alertas
                        alertaContainer.appendChild(novoCard);

                    }

                    // Cria o filtro acima do gráfico
                    const filtroContainer = document.createElement("div");
                    filtroContainer.id = "filtro-espera";
                    filtroContainer.style.marginLeft = "40px";
                    filtroContainer.innerHTML = `
                <input type="date" id="dataFiltro" />
                <button class="btn-filtrar" onclick="filtrarTempoEspera()">Filtrar</button>
            `;
                    modalBody.appendChild(filtroContainer);
                    // Configura o gráfico
                    const ctx = document.getElementById("MyChart").getContext("2d");
                    window.myChart = new Chart(ctx, {
                        type: "bar",
                        data: {
                            labels: labels,
                            datasets: [{
                                label: "Tempo de Espera (s)",
                                data: data,
                                backgroundColor: "rgba(0, 33, 72, 0.8)",
                                borderColor: "rgba(0, 33, 72, 1)",
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                })
                .catch(erro => {
                    console.error("Erro ao carregar os dados:", erro);
                    modalBody.innerHTML = "Erro ao carregar os dados. Tente novamente.";
                });
        }
    }

    function filtrarEficiencia(idFunc = idFuncionarioSelecionado) {


        const dataSelecionada = document.getElementById("dataFiltro").value;

        if (dataSelecionada) {
            console.log("Data selecionada para filtrar:", dataSelecionada);
            console.log(idFunc);

            const alertaBody = document.getElementById("cardAlerta2")
            const alertaContainer = document.querySelector(".alerta");
            console.log(idFuncionarioSelecionado)
            const modalBody = document.getElementById("modal-body");
            modalBody.innerHTML = "Carregando gráfico..."; // Exibe a mensagem de carregamento

            // Limpa qualquer gráfico anterior
            if (window.myChart) {
                window.myChart.destroy();
            }


            // Busca os dados de eficiência de chamadas
            fetch(`/funcionarios/dados/filtro/eficiencia/${dataSelecionada}/${idFunc}`, {
                method: "GET"
            })
                .then(resposta => resposta.json())  // Garante que a resposta seja tratada como JSON
                .then(dados => {
                    console.log("Dados recebidos:", dados);

                    // Verifica se os dados existem
                    if (!dados || dados.length === 0) {
                        modalBody.innerHTML = "Nenhum dado disponível para este gráfico.";
                        return;
                    }

                    // Acessa as chamadas recebidas e atendidas diretamente do objeto
                    const chamadasRecebidas = dados[0].chamadaRecebida;
                    const chamadasAtendidas = dados[0].chamadaAtendida;
                    console.log(chamadasRecebidas)
                    console.log(chamadasAtendidas)

                    // Calcula a eficiência
                    const eficiencia = (chamadasAtendidas / chamadasRecebidas) * 100;

                    // Exibe a eficiência no modal


                    if (eficiencia <= 70) {
                        // Cria um novo "card" de alerta
                        const novoCard = document.createElement("div");
                        novoCard.className = "bloco7"; // Classe para o novo card
                        novoCard.id = `cardAlerta`; // ID único baseado no funcionário

                        // Define o conteúdo do card
                        novoCard.innerHTML = `
                <p>Funcionário ${1} está com uma baixa eficiência.</p>
                
                `;
                        let textoEficiencia = `<p style="color: red;">Porcentagem de eficiência: ${eficiencia.toFixed(2)}%</p>`;
                        modalBody.innerHTML = textoEficiencia;

                        // Adiciona o novo card à div de alertas
                        alertaContainer.appendChild(novoCard);
                    } else {
                        let textoEficiencia = `<p>Eficiência de chamadas: ${eficiencia.toFixed(2)}%</p>`;
                        modalBody.innerHTML = textoEficiencia;
                    }

                    // Cria o filtro acima do gráfico
                    const filtroContainer = document.createElement("div");
                    filtroContainer.id = "filtro-chamada";
                    filtroContainer.style.marginRight = "2px";
                    filtroContainer.innerHTML = `
                <input type="date" id="dataFiltro" />
                <button class="btn-filtrar" onclick="filtrarEficiencia()">Filtrar</button>
            `;
                    modalBody.appendChild(filtroContainer);


                    // Cria o gráfico de barras
                    const ctx = document.getElementById("MyChart").getContext("2d");
                    window.myChart = new Chart(ctx, {
                        type: "bar", // Tipo do gráfico (barras)
                        data: {
                            labels: ["Chamadas Recebidas", "Chamadas Atendidas"], // Labels para as barras
                            datasets: [{
                                label: "Eficiência de Chamadas", // Rótulo para a legenda
                                data: [chamadasRecebidas, chamadasAtendidas], // Dados das chamadas
                                backgroundColor: [
                                    "rgba(0, 33, 72, 0.8)", // Cor para chamadas recebidas
                                    "rgba(43, 99, 132, 0.8)" // Cor para chamadas atendidas
                                ],
                                borderColor: [
                                    "rgba(0, 33, 72, 1)", // Borda para chamadas recebidas
                                    "rgba(43, 99, 132, 1)" // Borda para chamadas atendidas
                                ],
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            scales: {
                                y: {
                                    beginAtZero: true // Garante que o eixo Y comece do zero
                                }
                            }
                        }
                    });
                })
                .catch(erro => {
                    console.error("Erro ao carregar os dados:", erro);
                    modalBody.innerHTML = "Erro ao carregar os dados. Tente novamente."; // Exibe a mensagem de erro
                });
        }

    }

    function filtrarPerdida(idFunc = idFuncionarioSelecionado) {

        const dataSelecionada = document.getElementById("dataFiltro").value;

        if (dataSelecionada) {
            console.log(idFunc);
        const alertaContainer = document.querySelector(".alerta"); // Seleciona a div alerta
        const modalBody = document.getElementById("modal-body");
        modalBody.innerHTML = "Carregando gráfico...";

        // Limpa qualquer gráfico anterior
        if (window.myChart) {
            window.myChart.destroy();
        }

        fetch(`/funcionarios/dados/filtro/totalPerdida/${dataSelecionada}/${idFunc}`, {
            method: "GET"
        })
            .then(resposta => resposta.json())  // Garante que a resposta seja tratada como JSON
            .then(dados => {
                console.log("Dados recebidos:", dados);

                // Verifica se os dados existem
                if (!dados || dados.length === 0) {
                    modalBody.innerHTML = "Nenhum dado disponível para este gráfico.";
                    return;
                }

                // Acessa as chamadas perdidas e recebidas diretamente do objeto
                const chamadasRecebidas = dados[0].chamadasRecebidas;
                const chamadasPerdidas = dados[0].chamadasPerdidas;

                // Calcula a porcentagem de chamadas perdidas
                const totalChamadas = chamadasRecebidas + chamadasPerdidas;
                const porcentagemPerdida = ((chamadasPerdidas / totalChamadas) * 100).toFixed(2);

                // Atualiza o modal com o texto da porcentagem
                let textoPorcentagem = `<p>Total de chamadas perdidas: ${porcentagemPerdida}%</p>`;
                modalBody.innerHTML = textoPorcentagem;

                // Verifica se a porcentagem perdida é maior ou igual a 20%
                if (porcentagemPerdida >= 6) {
                    // Cria um novo "card" de alerta
                    const novoCard = document.createElement("div");
                    novoCard.className = "bloco7"; // Classe para o novo card
                    novoCard.id = `cardAlerta`; // ID único baseado no funcionário

                    // Define o conteúdo do card
                    novoCard.innerHTML = `
                <p>Funcionário ${idFunc} está com uma alta porcentagem de chamadas perdidas.</p>
                
                `;
                    let textoPorcentagem = `<p style="color: red;">Porcentagem de chamadas perdidas: ${porcentagemPerdida}%</p>`;
                    modalBody.innerHTML = textoPorcentagem;

                    // Adiciona o novo card à div de alertas
                    alertaContainer.appendChild(novoCard);
                }

                const filtroContainer = document.createElement("div");
                filtroContainer.id = "filtro-espera";
                filtroContainer.style.marginLeft = "40px";
                filtroContainer.innerHTML = `
                <input type="date" id="dataFiltro" />
                <button class="btn-filtrar" onclick="filtrarPerdida()">Filtrar</button>
            `;
                modalBody.appendChild(filtroContainer);

                // Cria o gráfico de barras
                const ctx = document.getElementById("MyChart").getContext("2d");
                window.myChart = new Chart(ctx, {
                    type: "bar",
                    data: {
                        labels: ["Chamadas Recebidas", "Chamadas Perdidas"],
                        datasets: [{
                            label: "Número de Chamadas",
                            data: [chamadasRecebidas, chamadasPerdidas],
                            backgroundColor: [
                                "rgba(0, 33, 72, 0.8)", // Cor para chamadas recebidas
                                "rgba(43, 99, 132, 0.8)" // Cor para chamadas perdidas
                            ],
                            borderColor: [
                                "rgba(0, 33, 72, 1)",
                                "rgba(43, 99, 132, 0.8)"
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            })
            .catch(erro => {
                console.error("Erro ao carregar os dados:", erro);
                modalBody.innerHTML = "Erro ao carregar os dados. Tente novamente.";
            });
        }
    }


    window.onload = function () {
        listarEquipes();  // Chama a função para listar as equipes
        atualizarFeedEquipe();
        puxarDadosEquipeChamada();   // Chama a função para atualizar o feed da equipe
        puxarTempoEquipeChamada();
        puxarTotalEquipeChamada();
        puxarTotalEquipePerdida();
        puxarTotalEquipeAtendida();
        eficienciaEquipeChamada();
        puxarDadosChamada(),
            puxarTempoChamada(),
            puxarTotalChamada(),
            puxarTotalPerdida(),
            puxarTotalAtendida(),
            eficienciaChamada()
    };


    document.addEventListener('DOMContentLoaded', function () {
        listarEquipes();  // Chama a função para listar as equipes
        atualizarFeedEquipe();
        // Chama a função para atualizar o feed da equipe
    });




</script>