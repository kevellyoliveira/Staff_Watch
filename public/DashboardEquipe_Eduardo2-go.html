<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Página Operário | Staff Watch</title>
    <link rel="stylesheet" href="./css/dashboard-eduardo.css">
    <script src="js/script.js" defer></script>
    <link rel="shortcut icon" href="./src/img/logoB.png" type="image/x-icon" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
        integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body>
    <header>
        <div class="opcoes">
            <div class="esq">
                <div class="logo">
                    <img href="index.html" src="./src/img/logoB.png" alt="logo">
                </div>
                <div class="opcoesComponentes" id="itens">
                    <h6 class="opcoesMenu" onclick="levarParaDashboard()">Home</h6>
                    <h6 class="opcoesMenu slct associMenu" onclick="abrirMenu()">Associados <img
                            src="./src/img/icons/seta.png" alt="icone menu vertical"></h6>
                    <h6 class="opcoesMenu" onclick="window.location.href='cadastroFuncionario.html'">Cadastrar</h6>
                    <div id="menu">
                        <h4 onclick="window.location.href='pagina-operario2.html'">Funcionários</h4>
                        <h4 onclick="window.location.href='pagina-maquina.html'">Dispositivos</h4>
                        <h4 onclick="window.location.href='cadastroEquipe.html'">Equipe</h4>
                    </div>
                </div>
            </div>
            <div class="sair">
                <h6 class="opcoesMenu sair" onclick="sair()"> Sair </h6>
            </div>
        </div>
    </header>
    <div class="pai">
        <button class="open-btn" onclick="openMenu()">☰</button>

        <div id="sideMenu" class="side-menu">
            <button class="close-btn" onclick="closeMenu()">☰</button>
            <div class="menuLateral">
                <div class="itens">
                    <h4 id="home" class="historico" onclick="window.location.href='dashboardPedroPorfirio.html'">Home
                    </h4>
                    <!-- Aqui as equipes serão inseridas dinamicamente pelo JavaScript -->
                    <h4 id="novaEquipe" class="novaequipe" onclick="window.location.href='./novaEquipe.html'">Nova
                        Equipe</h4>
                </div>
            </div>
        </div>
        <div>
            <h1 class="TITULO">Monitoramento da equipe</h1>
            <div class="Dashboard-chamada">
                <div class="son6">
                    <div class="bloco3">Tempo médio atendimento:
                        <div class="minibloco"></div>
                    </div>

                    <div class="bloco4">Tempo médio espera:
                        <div class="minibloco1"></div>
                    </div>
                    <div class="bloco5">Eficiência:
                        <div class="minibloco2"></div>
                    </div>

                    <div class="bloco6">Chamadas perdida:
                        <div class="minibloco3"></div>
                    </div>
                </div>
            </div>
            <article class="title">

                <input type="text" name="Pesquisar" id="pesquisar_input" required="required" autocomplete="off"
                    placeholder="Pesquisar funcionário"><button onclick="listarPorUsuario()" id="listar"><i
                        class="fa-solid fa-magnifying-glass"></i></button>
            </article>
            <br>
            <br>
            <div class="funcs">
                <div id="feed_container" class="feed-container"></div>
            </div>
        </div>
            <!-- Modal -->
            <!-- Modal -->
            <!-- Modal -->
            <div id="fade" class="hide"></div>
            <div id="modal" class="hide">
                <div class="modal-content">
                    <!-- Títulos no topo -->
                    <div id="modal-titles" class="opcoesComponentes">
                        <h6 class="opcoesMenu" id="cpu" onclick="puxarTempoChamada()">Tempo médio</h6>
                        <h6 class="opcoesMenu" id="disco" onclick="puxarDadosChamada()">Tempo médio espera</h6>
                        <h6 class="opcoesMenu" id="rede" onclick="eficienciaEquipeChamada()">Eficiência</h6>
                        <h6 class="opcoesMenu" id="memoria" onclick="puxarTotalPerdida()">Chamadas perdidas</h6>
                    </div>
            
                    <!-- Gráfico no meio -->
                    <div class="grafico">
                        <canvas id="MyChart" style="height: 175px;"></canvas>
                    </div>
            
                    <!-- Corpo do modal -->
                    <div id="modal-body"></div>
            
                    <!-- Botão de fechar -->
                    <button onclick="fecharModal()" id="botaoSaida">Fechar</button>
                </div>
            </div>
            
        <div class="alerta">
            <h1>Alertas</h1>
            <div class="bloco7">Tempo médio de espera:</div>
            <div class="bloco8">Tempo médio de espera:</div>
        </div>
    </div>
</body>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</html>

<script>
    function abrirMenu() {
        if (document.getElementById("menu").style.display == "flex") {
            document.getElementById("menu").style.display = "none";
        } else {
            document.getElementById("menu").style.display = "flex"
        }
    }
    function openMenu() {
        document.getElementById("sideMenu").style.left = "0";
    }

    // Função para fechar o menu
    function closeMenu() {
        document.getElementById("sideMenu").style.left = "-250px";
    }

    var fkCargo = sessionStorage.FK_CARGO;

    function sair() {
        sessionStorage.clear()
        window.location = "index.html"
    }

    function atualizarFeedEquipe() {
        var fkEmpresa = sessionStorage.getItem("ID_EMPRESA");
        var fkEquipe = sessionStorage.getItem("equipeSelecionada");

        console.log(fkEmpresa);
        console.log(fkEquipe);
        console.log("---------");

        fetch(`/funcionarios/listarEquipe/${fkEmpresa}/${fkEquipe}`).then(function (resposta) {
            if (resposta.ok) {
                if (resposta.status == 204) {
                    var feed = document.getElementById("feed_container");
                    var mensagem = document.createElement("span");
                    mensagem.innerHTML = "Nenhum resultado encontrado.";
                    feed.appendChild(mensagem);
                    throw "Nenhum resultado encontrado!!";
                }

                resposta.json().then(function (resposta) {
                    console.log("Dados recebidos: ", JSON.stringify(resposta));

                    var feed = document.getElementById("feed_container");
                    feed.innerHTML = ""; // Limpa o conteúdo atual do feed

                    for (let i = 0; i < resposta.length; i++) {
                        var publicacao = resposta[i];

                        // Criando e manipulando elementos do HTML via JavaScript
                        var divContent = document.createElement("div");
                        var divPublicacao = document.createElement("div");
                        var spanID = document.createElement("span");
                        var spanTitulo = document.createElement("span");
                        var spanNome = document.createElement("span");
                        var divDescricao = document.createElement("div");
                        var divButtons = document.createElement("div");
                        var btnEditar = document.createElement("button");
                        var btnDeletar = document.createElement("button");

                        // Definindo conteúdo dos elementos

                        spanID.innerHTML = "<div class='id'> Id Funcionário: <b>" + publicacao.idFuncionario + "</b> </div> <br>";
                        spanTitulo.innerHTML = "E-mail: <b>" + publicacao.email + "</b>";
                        spanNome.innerHTML = "Nome: <b>" + publicacao.nome + "</b>";
                        divDescricao.innerHTML = "Equipe: <b>" + publicacao.fkEquipe + "</b>";

                        // Configurando o botão "Editar"
                        // btnEditar.innerHTML = '<i class="fa-solid fa-pen"></i>'; // Ícone do botão
                        // btnEditar.className = "editar"; // Classe do botão
                        // btnEditar.id = "AbrirModal_" + publicacao.idFuncionario; // ID único baseado no ID do funcionário
                        let idDaVez = publicacao.idFuncionario;
                        divPublicacao.addEventListener('click', function () {
                            abrirModal(idDaVez); // Abre o modal passando o ID do funcionário
                        });

                        // Configurando o botão "Deletar"
                        // btnDeletar.innerHTML = '<i class="fa-solid fa-trash"></i>'; // Ícone do botão
                        // btnDeletar.className = "deletar"; // Classe do botão
                        // btnDeletar.id = "btnDeletar_" + publicacao.idFuncionario; // ID único
                        // btnDeletar.addEventListener('click', function () {
                        //     deletar(idDaVez); // Função 'deletar' com ID do funcionário
                        // });

                        // Adicionando os botões ao container de botões
                        divButtons.className = "div-buttons";
                        divButtons.appendChild(btnEditar);
                        divButtons.appendChild(btnDeletar);

                        // Adicionando todos os elementos criados ao divPublicacao
                        divPublicacao.className = "publicacao";
                        divPublicacao.appendChild(spanID);
                        divPublicacao.appendChild(spanNome);
                        divPublicacao.appendChild(spanTitulo);
                        divPublicacao.appendChild(divDescricao);
                        divPublicacao.appendChild(divButtons);

                        // Adicionando o card de publicação ao feed
                        feed.appendChild(divPublicacao);
                    }
                });
            } else {
                throw ('Houve um erro na API!');
            }
        }).catch(function (resposta) {
            console.error(resposta);
        });
    }

    function abrirModal(idFuncionario) {
    const ctx = document.getElementById("MyChart");

    // Destruir gráfico existente, se houver
    if (window.myChart instanceof Chart) {
        window.myChart.destroy();
    }

    // Exibir mensagem inicial no modal
    var modalBody = document.getElementById("modal-body");
    modalBody.innerHTML = "Carregando informações...";

    // Fazer a requisição para obter os dados do funcionário
    fetch(`/funcionarios/dados/tempoChamada/${idFuncionario}`)
        .then(response => {
            if (!response.ok) {
                throw new Error('Erro ao buscar dados do servidor.');
            }
            return response.json();
        })
        .then(data => {
            console.log("Dados retornados:", data);

            // Calcular o tempo médio
            const tempoTotal = data.reduce((soma, funcionario) => soma + funcionario.tempoChamada, 0);
            const tempoMedio = (tempoTotal / data.length).toFixed(2);

            console.log("Tempo Médio Calculado:", tempoMedio);

            // Criar o gráfico de barras com uma única barra
            window.myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ["Tempo Médio"], // Rótulo único para a barra
                    datasets: [{
                        label: "Tempo Médio de Chamada (s)",
                        data: [tempoMedio], // Valor único
                        backgroundColor: "#002148",
                        borderColor: "#002148",
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // Remover a mensagem de "Carregando"
            modalBody.innerHTML = ""; // Limpar conteúdo do modal-body
        })
        .catch(error => {
            console.error("Erro ao carregar gráfico:", error);
            modalBody.innerHTML = "Erro ao carregar os dados do gráfico. Tente novamente mais tarde.";
        });

    // Mostrar o modal
    document.getElementById("fade").classList.remove("hide");
    document.getElementById("fade").classList.add("show");
    document.getElementById("modal").classList.remove("hide");
    document.getElementById("modal").classList.add("show");
}


    function fecharModal() {
        document.getElementById("fade").classList.remove("show");
        document.getElementById("fade").classList.add("hide");
        document.getElementById("modal").classList.remove("show");
        document.getElementById("modal").classList.add("hide");
    }



    function levarParaDashboard() {
        if (fkCargo == 3) {
            window.location.href = "/dashboardGeral-gti.html";
        } else if (fkCargo == 2) {
            window.location.href = "/dashboardPedroPorfirio.html";
        }

    }

    function redirecionarParaEdicao(idFuncionario) {
        // Redireciona o usuário para a página de edição com o ID do funcionário como parâmetro na URL
        window.location.href = `editarFuncionario.html?id=${idFuncionario}`;
    }

    function deletar(idFuncionario) {
        if (confirm("Tem a certeza de que deseja deletar este funcionário?")) {
            fetch(`/funcionarios/deletar/${idFuncionario}`, {
                method: "get"
            })
                .then(resposta => {
                    if (resposta.ok) {
                        // alert("Funcionário deletado com sucesso!");
                        atualizarFeed(); // Atualiza a lista após a exclusão
                    } else {
                        throw "Não foi possível deletar o funcionário.";
                    }
                })
                .catch(error => {
                    console.error(error);
                    // alert("Ocorreu um erro ao tentar deletar o funcionário.");
                });
        }
    }

    function puxarDadosChamada(idFuncionario) {

        fetch(`/funcionarios/dados/tempoEspera/${idFuncionario}`, {
            method: "GET"
        })
            .then(resposta => {
                if (resposta.ok) {
                    // alert("Captura de dados de tempo de Espera de chamada efetuada ");
                    ; // Atualiza a lista após a exclusão
                } else {
                    throw "Não foi possível capturar os dados do funcionário.";
                }
            })
            .catch(error => {
                console.error(error);
                //alert("Ocorreu um erro ao tentar capturar dados do funcionário.");
            });
    }

    function puxarTempoChamada(idFuncionario) {
        fetch(`/funcionarios/dados/tempoChamada/${idFuncionario}`, {
            method: "GET"
        })
            .then(resposta => {
                if (resposta.ok) {
                    return resposta.json(); // Corrigido 'response' para 'resposta'
                } else {
                    throw "Não foi possível capturar os dados do funcionário.";
                }
            })
            .then(data => { // Esse 'then' deve ser separado do anterior
                // const qtdTempoChamada = data[1].tempoChamada; // Acesso aos dados
                // document.querySelector('.minibloco').textContent = qtdTempoChamada + "s"; // Atualiza o conteúdo
            })
            .catch(error => {
                console.error(error);
                // alert("Ocorreu um erro ao tentar capturar dados do funcionário.");
            });
    }


    function puxarTotalChamada(idFuncionario) {

        fetch(`/funcionarios/dados/totalChamada/${idFuncionario}`, {
            method: "GET"
        })
            .then(resposta => {
                if (resposta.ok) {
                    console.log(resposta)
                        // alert("Captura de dados total de chamadas efetuadas ");
                        ; // Atualiza a lista após a exclusão
                } else {
                    throw "Não foi possível capturar o total de chamadas do funcionário.";
                }
            })
            .catch(error => {
                console.error(error);
                // alert("Ocorreu um erro ao tentar capturar o total de chamadas do funcionário");
            });
    }


    function puxarTotalPerdida(idFuncionario) {

        fetch(`/funcionarios/dados/totalPerdida/${idFuncionario}`, {
            method: "GET"
        })
            .then(resposta => {
                if (resposta.ok) {
                    console.log(resposta)
                        //alert("Captura de dados total de chamadas perdida efetuadas ");
                        ; // Atualiza a lista após a exclusão
                } else {
                    throw "Não foi possível capturar o total de chamadas perdidas do funcionário.";
                }
            })
            .catch(error => {
                console.error(error);
                //alert("Ocorreu um erro ao tentar capturar o total de chamadas perdidas do funcionário");
            });
    }

    function puxarTotalAtendida(idFuncionario) {

        fetch(`/funcionarios/dados/totalAtendida/${idFuncionario}`, {
            method: "GET"
        })
            .then(resposta => {
                if (resposta.ok) {
                    console.log(resposta)
                        //  alert("Captura de dados total de chamadas atendida efetuadas ");
                        ; // Atualiza a lista após a exclusão
                } else {
                    throw "Não foi possível capturar o total de chamadas atendidas do funcionário.";
                }
            })
            .catch(error => {
                console.error(error);
                //  alert("Ocorreu um erro ao tentar capturar o total de chamadas atendidas do funcionário");
            });
    }

    // equipe


    function puxarDadosEquipeChamada(fkEquipe) {

        fetch(`/funcionarios/dados/tempoEspera/${fkEquipe}`, {
            method: "GET"
        })
            .then(resposta => {
                if (resposta.ok) {
                    return resposta.json(); // Retorna os dados em JSON
                } else {
                    throw new Error("Não foi possível capturar os dados de tempo de espera do funcionário.");
                }
            })
            .then(data => {
                if (data && Array.isArray(data)) { // Valida se 'data' é um array
                    const tempoTotalEspera = data.reduce((soma, funcionario) => soma + funcionario.tempoEspera, 0);
                    const tempoMedioEspera = (tempoTotalEspera / data.length).toFixed(2); // Cálculo médio e arredondamento
                    document.querySelector('.minibloco1').textContent = `${tempoMedioEspera}s`; // Atualiza a UI
                } else {
                    throw new Error("Dados inesperados recebidos do servidor.");
                }
            })
            .catch(error => {
                console.error("Erro:", error.message);
                document.querySelector('.minibloco').textContent = "Erro ao carregar dados."; // Feedback para o utilizador
            });
    }

    function puxarTempoEquipeChamada(fkEquipe) {
        fetch(`/funcionarios/dados/tempoChamada/${fkEquipe}`, {
            method: "GET"
        })
            .then(resposta => {
                if (resposta.ok) {
                    return resposta.json(); // Retorna os dados em JSON
                } else {
                    throw new Error("Não foi possível capturar os dados do funcionário.");
                }
            })
            .then(data => {
                if (data && Array.isArray(data)) { // Valida se 'data' é um array
                    const tempoTotal = data.reduce((soma, funcionario) => soma + funcionario.tempoChamada, 0);
                    const tempoMedio = (tempoTotal / data.length).toFixed(2); // Cálculo médio e arredondamento
                    document.querySelector('.minibloco').textContent = `${tempoMedio}s`; // Atualiza a UI
                } else {
                    throw new Error("Dados inesperados recebidos do servidor.");
                }
            })
            .catch(error => {
                console.error("Erro:", error.message);
                document.querySelector('.minibloco').textContent = "Erro ao carregar dados."; // Feedback para o utilizador
            });
    }



    function puxarTotalEquipeChamada(fkEquipe) {

        fetch(`/funcionarios/dados/totalChamada/${fkEquipe}`, {
            method: "GET"
        })
            .then(resposta => {
                if (resposta.ok) {
                    console.log(resposta)
                        // alert("Captura de dados total de chamadas efetuadas ");
                        ; // Atualiza a lista após a exclusão
                } else {
                    throw "Não foi possível capturar o total de chamadas do funcionário.";
                }
            })
            .catch(error => {
                console.error(error);
                // alert("Ocorreu um erro ao tentar capturar o total de chamadas do funcionário");
            });
    }


    function puxarTotalEquipePerdida(fkEquipe) {
        fetch(`/funcionarios/dados/totalPerdida/${fkEquipe}`, {
            method: "GET"
        })
            .then(resposta => {
                if (resposta.ok) {
                    return resposta.json(); // Retorna os dados em JSON
                } else {
                    throw new Error("Não foi possível capturar os dados de chamadas perdidas da equipe.");
                }
            })
            .then(data => {
                console.log("Dados recebidos:", data); // Log para verificar o formato dos dados

                if (Array.isArray(data) && data.length > 0) { // Verifica se é um array e contém elementos
                    const totalChamadasPerdidas = data[0].chamadaPerdida; // Acessa o primeiro objeto do array
                    document.querySelector('.minibloco3').textContent = `${totalChamadasPerdidas} chamadas perdidas`;
                } else {
                    throw new Error("Formato inesperado dos dados recebidos.");
                }
            })
            .catch(error => {
                console.error("Erro:", error.message);
                document.querySelector('.minibloco3').textContent = "Erro ao carregar dados."; // Feedback para o utilizador
            });
    }

    function eficienciaEquipeChamada(fkEquipe) {
        fetch(`/funcionarios/dados/eficienciaEquipeChamada/${fkEquipe}`, {
            method: "GET"
        })
            .then(resposta => {
                if (resposta.ok) {
                    return resposta.json(); // Retorna os dados em JSON
                } else {
                    throw new Error("Não foi possível capturar os dados de chamadas da equipe.");
                }
            })
            .then(data => {
                console.log("Dados recebidos:", data); // Log para verificar o formato dos dados

                if (Array.isArray(data) && data.length > 0) { // Verifica se é um array e contém elementos
                    const totalChamadas = data[0].chamadaRecebida;
                    const totalChamadasAtendidas = data[0].chamadaAtendida;

                    // Garantir que os valores são válidos antes de realizar o cálculo
                    if (totalChamadas > 0) {
                        const eficiencia = (totalChamadasAtendidas / totalChamadas) * 100; // Calcula a eficiência
                        document.querySelector('.minibloco2').textContent = `${eficiencia.toFixed(2)}%`; // Exibe a eficiência formatada
                    } else {
                        document.querySelector('.minibloco2').textContent = "Não há chamadas registradas."; // Caso não haja chamadas
                    }
                } else {
                    throw new Error("Formato inesperado dos dados recebidos.");
                }
            })
            .catch(error => {
                console.error("Erro:", error.message);
                document.querySelector('.minibloco2').textContent = `Erro ao carregar dados: ${error.message}`; // Exibe o erro detalhado
            });
    }






    function puxarTotalEquipeAtendida(fkEquipe) {

        fetch(`/funcionarios/dados/totalAtendida/${fkEquipe}`, {
            method: "GET"
        })
            .then(resposta => {
                if (resposta.ok) {
                    console.log(resposta)
                        //  alert("Captura de dados total de chamadas atendida efetuadas ");
                        ; // Atualiza a lista após a exclusão
                } else {
                    throw "Não foi possível capturar o total de chamadas atendidas do funcionário.";
                }
            })
            .catch(error => {
                console.error(error);
                //  alert("Ocorreu um erro ao tentar capturar o total de chamadas atendidas do funcionário");
            });
    }


    function listarPorUsuario() {
        const inputPesquisa = document.getElementById("pesquisar_input").value; // Pega o valor do input
        const fkEmpresa = sessionStorage.getItem("ID_EMPRESA");
        console.log(fkEmpresa)

        // Faz uma requisição à API, passando o termo de pesquisa
        fetch(`/funcionarios/listar/${fkEmpresa}/${inputPesquisa}`).then(function (resposta) {
            if (resposta.ok) {
                if (resposta.status == 204) {
                    const feed = document.getElementById("feed_container");
                    feed.innerHTML = "Nenhum resultado encontrado.";
                    return;
                }

                resposta.json().then(function (resposta) {
                    const feed = document.getElementById("feed_container");
                    feed.innerHTML = ""; // Limpa o conteúdo atual do feed

                    resposta.forEach((publicacao) => {
                        const divPublicacao = document.createElement("div");
                        const spanID = document.createElement("span");
                        const spanTitulo = document.createElement("span");
                        const spanNome = document.createElement("span");
                        const divDescricao = document.createElement("div");
                        const divButtons = document.createElement("div");
                        const btnEditar = document.createElement("button");
                        const btnDeletar = document.createElement("button");

                        spanID.innerHTML = "<div class='id'> Id Funcionário: <b>" + publicacao.idFuncionario + "</b> </div> <br>";
                        spanTitulo.innerHTML = "E-mail: <b>" + publicacao.email + "</b>";
                        spanNome.innerHTML = "Nome: <b>" + publicacao.nome + "</b>";
                        divDescricao.innerHTML = "Equipe: <b>" + publicacao.fkEquipe + "</b>";

                        btnEditar.innerHTML = '<i class="fa-solid fa-pen"></i>';
                        btnEditar.className = "editar";
                        btnEditar.id = "AbrirModal2_" + publicacao.idFuncionario;
                        btnEditar.addEventListener('click', function () {
                            redirecionarParaEdicao(publicacao.idFuncionario);
                        });

                        btnDeletar.innerHTML = '<i class="fa-solid fa-trash"></i>';
                        btnDeletar.className = "deletar";
                        btnDeletar.id = "btnDeletar_" + publicacao.idFuncionario;
                        btnDeletar.addEventListener('click', function () {
                            deletar(publicacao.idFuncionario);
                        });

                        divButtons.className = "div-buttons";
                        divButtons.appendChild(btnEditar);
                        divButtons.appendChild(btnDeletar);

                        divPublicacao.className = "publicacao";
                        divPublicacao.appendChild(spanID);
                        divPublicacao.appendChild(spanNome);
                        divPublicacao.appendChild(spanTitulo);
                        divPublicacao.appendChild(divDescricao);
                        divPublicacao.appendChild(divButtons);

                        feed.appendChild(divPublicacao);
                    });
                });
            } else {
                console.error("Houve um erro na API.");
            }
        }).catch(function (erro) {
            console.error("Erro na requisição:", erro);
        });
    }

    function listarEquipes() {
        const fkEmpresa = sessionStorage.getItem("ID_EMPRESA");

        fetch(`funcionarios/listarEquipes/${fkEmpresa}`)
            .then(resposta => {
                if (resposta.ok) {
                    return resposta.json(); // Se a resposta for válida, converte para JSON
                } else {
                    console.error("Erro ao carregar equipes, status:", resposta.status);
                    return [];
                }
            })
            .then(dados => {
                console.log("Equipes carregadas:", dados);

                // Seleciona o menu lateral e os itens fixos
                const menuLateral = document.querySelector(".menuLateral .itens");
                const historicoItem = document.querySelector("#home");
                const novaEquipeItem = document.querySelector("#novaEquipe");

                // Limpa o menu sem remover os itens fixos
                menuLateral.innerHTML = ''; // Limpa todos os itens
                menuLateral.appendChild(historicoItem); // Reinsere o item "Home"

                // Adiciona as equipes dinamicamente
                if (dados.length > 0) {
                    dados.forEach(equipe => {
                        const h4 = document.createElement("h4");
                        h4.textContent = equipe.nome;
                        h4.classList.add("equipe"); // Adiciona uma classe para estilização
                        h4.onclick = () => selecionarItem(equipe.id);
                        menuLateral.appendChild(h4);
                    });
                } else {
                    // Exibe mensagem caso não existam equipes
                    const noTeamsMessage = document.createElement("h4");
                    noTeamsMessage.textContent = "Nenhuma equipe encontrada.";
                    noTeamsMessage.classList.add("sem-equipes");
                    menuLateral.appendChild(noTeamsMessage);
                }

                // Reinsere a opção "Nova Equipe"
                menuLateral.appendChild(novaEquipeItem);
            })
            .catch(erro => {
                console.error("Erro ao carregar as equipes:", erro);
            });
    }

    window.onload = function () {
        listarEquipes();  // Chama a função para listar as equipes
        atualizarFeedEquipe();
        puxarDadosEquipeChamada();   // Chama a função para atualizar o feed da equipe
        puxarTempoEquipeChamada();
        puxarTotalEquipeChamada();
        puxarTotalEquipePerdida();
        puxarTotalEquipeAtendida();
        eficienciaEquipeChamada();
    };


    document.addEventListener('DOMContentLoaded', function () {
        listarEquipes();  // Chama a função para listar as equipes
        atualizarFeedEquipe();
        // Chama a função para atualizar o feed da equipe
    });



</script>