<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Página Operário | Staff Watch</title>
    <link rel="stylesheet" href="./css/telaListas.css">
    <script src="./js/script.js"></script>
    <link rel="shortcut icon" href="./src/img/logoB.png" type="image/x-icon" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
    integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />

</head>

<body onload="atualizarFeed()">
    <header>
        <div class="opcoes">
            <div class="esq">
                <div class="logo">
                    <img href="index.html" src="./src/img/logoB.png" alt="logo">
                </div>

                <div class="opcoesComponentes" id="itens">
                    <h6 class="opcoesMenu" onclick="levarParaDashboard()">Home</h6>
                    <h6 class="opcoesMenu slct associMenu" onclick="abrirMenu()">Associados <img
                            src="./src/img/icons/seta.png" alt="icone menu vertical"></h6>
                    <h6 class="opcoesMenu" onclick="window.location.href='cadastroFuncionario.html'">Cadastrar</h6>
                    <div id="menu">
                        <h4 onclick="window.location.href='pagina-operario2.html'">Funcionários</h4>
                        <h4 onclick="window.location.href='pagina-maquina.html'">Dispositivos</h4>
                        <h4 onclick="window.location.href='cadastroEquipe.html'">Equipe</h4>

                        
                    </div>
                </div>
            </div>

            <div class="sair">
                <h6 class="opcoesMenu sair" onclick="sair()"> Sair </h6>
            </div>
        </div>
    </header>

    <article class="title">
        <h2>
            Dispositivos
        </h2>
    </article>

    <div class="funcs">
        <div id="feed_container" class="feed-container"></div>
    </div>

    <!-- <main class="main-section">
        <section class="section-card">
            <div class="card open-modal">
                <div class="up-card">
                    <img src="./src/img/icons/editar.svg" alt="">
                    <img src="./src/img/icons/excluir.svg" alt="">
                </div>
                <div class="down-card">
                    <figure>
                        <img src="./src/img/computador-portatil (2) 1.png" alt="">
                    </figure>
                    <div class="content-card">
                        <p><b>ID:</b> 23433454</p>
                        <p><b>Operário:</b> José Antônio da Silva</p>
                    </div>
                </div>
            </div>
            <div class="card open-modal">
                <div class="up-card">
                    <img src="./src/img/icons/editar.svg" alt="">
                    <img src="./src/img/icons/excluir.svg" alt="">
                </div>
                <div class="down-card">
                    <figure>
                        <img src="./src/img/computador-portatil (2) 1.png" alt="">
                    </figure>
                    <div class="content-card">
                        <p><b>ID:</b> 23433454</p>
                        <p><b>Operário:</b> José Antônio da Silva</p>
                    </div>
                </div>
            </div>
            <div class="card open-modal">
                <div class="up-card">
                    <img src="./src/img/icons/editar.svg" alt="">
                    <img src="./src/img/icons/excluir.svg" alt="">
                </div>
                <div class="down-card">
                    <figure>
                        <img src="./src/img/computador-portatil (2) 1.png" alt="">
                    </figure>
                    <div class="content-card">
                        <p><b>ID:</b>23433454</p>
                        <p><b>Operário:</b> José Antônio da Silva</p>
                    </div>
                </div>
            </div>
        </section>

        <section class="section-card">
            <div class="card open-modal">
                <div class="up-card">
                    <img src="./src/img/icons/editar.svg" alt="">
                    <img src="./src/img/icons/excluir.svg" alt="">
                </div>
                <div class="down-card">
                    <figure>
                        <img src="./src/img/computador-portatil (2) 1.png" alt="">
                    </figure>
                    <div class="content-card">
                        <p><b>ID:</b> 23433454</p>
                        <p><b>Operário:</b> José Antônio da Silva</p>
                    </div>
                </div>
            </div>
            <div class="card open-modal">
                <div class="up-card">
                    <img src="./src/img/icons/editar.svg" alt="">
                    <img src="./src/img/icons/excluir.svg" alt="">
                </div>
                <div class="down-card">
                    <figure>
                        <img src="./src/img/computador-portatil (2) 1.png" alt="">
                    </figure>
                    <div class="content-card">
                        <p><b>ID:</b> 23433454</p>
                        <p><b>Operário:</b> José Antônio da Silva</p>
                    </div>
                </div>
            </div>
            <div class="card open-modal">
                <div class="up-card">
                    <img src="./src/img/icons/editar.svg" alt="">
                    <img src="./src/img/icons/excluir.svg" alt="">
                </div>
                <div class="down-card">
                    <figure>
                        <img src="./src/img/computador-portatil (2) 1.png" alt="">
                    </figure>
                    <div class="content-card">
                        <p><b>ID:</b> 23433454</p>
                        <p><b>Operário:</b> José Antônio da Silva</p>
                    </div>
                </div>
            </div>
        </section>
        <section class="section-card">
            <div class="card open-modal">
                <div class="up-card">
                    <img src="./src/img/icons/editar.svg" alt="">
                    <img src="./src/img/icons/excluir.svg" alt="">
                </div>
                <div class="down-card">
                    <figure>
                        <img src="./src/img/computador-portatil (2) 1.png" alt="">
                    </figure>
                    <div class="content-card">
                        <p><b>ID:</b> 23433454</p>
                        <p><b>Operário:</b> José Antônio da Silva</p>
                    </div>
                </div>
            </div>
            <div class="card open-modal">
                <div class="up-card">
                    <img src="./src/img/icons/editar.svg" alt="">
                    <img src="./src/img/icons/excluir.svg" alt="">
                </div>
                <div class="down-card">
                    <figure>
                        <img src="./src/img/computador-portatil (2) 1.png" alt="">
                    </figure>
                    <div class="content-card">
                        <p><b>ID:</b> 23433454</p>
                        <p><b>Operário:</b> José Antônio da Silva</p>
                    </div>
                </div>
            </div>
            <div class="card open-modal">
                <div class="up-card">
                    <img src="./src/img/icons/editar.svg" alt="">
                    <img src="./src/img/icons/excluir.svg" alt="">
                </div>
                <div class="down-card">
                    <figure>
                        <img src="./src/img/computador-portatil (2) 1.png" alt="">
                    </figure>
                    <div class="content-card">
                        <p><b>ID:</b> 23433454</p>
                        <p><b>Operário:</b> José Antônio da Silva</p>
                    </div>
                </div>
            </div>
        </section>
    </main>
    <div id="modal" class="hide">
        <div class="modal-header">
            <figure>
                <img src="./src/img/computador-portatil (2) 3.png" alt="">
            </figure>
        </div>
        <div class="modal-content">
            <div class="modal-user">
                <p><b>ID:</b> 23433454</p>
                <p><b>Marca:</b> 23433454</p>
                <p><b>Máquina:</b> 23433454</p>
                <p><b>GPU:</b> 23433454</p>
                <p><b>CPU:</b> 23433454</p>
                <p><b>RAM:</b> 23433454</p>
                <p><b>Memória:</b> 23433454</p>
                <p><b>SO:</b> 23433454</p>
            </div>
            <div class="modal-form">
                <p><b>Nome:</b> José Antônio da Silva</p>
                <p><b>Nascimento:</b> 28/08/1995</p>
                <p><b>Email:</b> Jose.Silva@email.com</p>
                <p><b>Equipe:</b> 1</p>
            </div>
        </div>
    </div>
    <div id="fade" class="hide"></div> -->
</body>
</html>

<script>

    var fkCargo = sessionStorage.FK_CARGO;
    
    function abrirMenu() {
        if (document.getElementById("menu").style.display == "flex") {
            document.getElementById("menu").style.display = "none";
        } else {
            document.getElementById("menu").style.display = "flex"
        }
    }
    
    function sair() {
        sessionStorage.clear()
        window.location = "index.html"
    }

    function levarParaDashboard() {
        if(fkCargo == 3){
                        window.location.href = "/dashboardGeral-gti.html";
                    } else if (fkCargo == 2){
                        window.location.href = "/dashboardGeral-go.html";
                    }

    }


    function atualizarFeed() {
        var fkEmpresa = sessionStorage.getItem("ID_EMPRESA")
        console.log(fkEmpresa)
        fetch(`/maquinas/listar/${fkEmpresa}`).then(function (resposta) {
            if (resposta.ok) {
                if (resposta.status == 204) {
                    var feed = document.getElementById("feed_container");
                    var mensagem = document.createElement("span");
                    mensagem.innerHTML = "Nenhum resultado encontrado.";
                    feed.appendChild(mensagem);
                    throw "Nenhum resultado encontrado!!";
                }

                resposta.json().then(function (resposta) {
                    console.log("Dados recebidos: ", JSON.stringify(resposta));

                    var feed = document.getElementById("feed_container");
                    feed.innerHTML = ""; // Limpa o conteúdo atual do feed
                    for (let i = 0; i < resposta.length; i++) {
                        var publicacao = resposta[i];

                        // Criando e manipulando elementos do HTML via JavaScript
                        var divPublicacao = document.createElement("div");
                        var spanID = document.createElement("span");
                        var spanTitulo = document.createElement("span");
                        var spanNome = document.createElement("span");
                        var divDescricao = document.createElement("div");


                        var divButtons = document.createElement("div");
                        var btnEditar = document.createElement("button");
                        var btnDeletar = document.createElement("button");


                        if (publicacao.status == 1) {
                            var status = "Em atividade"
                        }

                        if (publicacao.status == 2) {
                            var status = "Inativo"
                        }

                        // Definindo conteúdo dos elementos
                        spanID.innerHTML = "<div class='id'> Id Máquina: <b>" + publicacao.idComputador + "</b> </div> <br>";
                        spanTitulo.innerHTML = "Equipe: <b>" + publicacao.nomeEquipe+ "</b>";
                        spanNome.innerHTML = "Funcionario: <b>" + publicacao.nomeFuncionario + "</b>";
                        // divDescricao.innerHTML = "Status: <b>" + status + "</b>";

                        if (publicacao.status == 1) {
                            divDescricao.innerHTML = "Status: <b style='color: #F6FF53  ;'>" + status + "</b>";

                        } 

                        if (publicacao.status == 2) {
                            divDescricao.innerHTML = "Status: <b style='color: #FFA700;'>" + status + "</b>";

                        }

                        // Configurando o botão "Editar"
                        btnEditar.innerHTML = '<i class="fa-solid fa-pen"></i>'; // Ícone do botão
                        btnEditar.className = "editar"; // Classe do botão
                        btnEditar.id = "AbrirModal2_" + publicacao.idComputador; // ID único baseado no ID do funcionário
                        let idDaVez = publicacao.idComputador
                        btnEditar.addEventListener('click', function () {
                            atualizarMaquina(idDaVez); // Função que redireciona para a página de edição
                        });

                        // Configurando o botão "Deletar"
                        btnDeletar.innerHTML = '<i class="fa-solid fa-trash"></i>'; // Ícone do botão
                        btnDeletar.className = "deletar"; // Classe do botão
                        btnDeletar.id = "btnDeletar_" + publicacao.idComputador; // ID único
                        btnDeletar.addEventListener('click', function () {
                            deletar(idDaVez); // Função 'deletar' com ID do funcionário
                        });

                        // Adicionando os botões ao container de botões
                        divButtons.className = "div-buttons";
                        divButtons.appendChild(btnEditar);
                        divButtons.appendChild(btnDeletar);

                        // Adicionando todos os elementos criados ao divPublicacao
                        divPublicacao.className = "publicacao";
                        divPublicacao.appendChild(spanID);
                        divPublicacao.appendChild(spanNome);
                        divPublicacao.appendChild(spanTitulo);
                        divPublicacao.appendChild(divDescricao);
                        divPublicacao.appendChild(divButtons);

                        // Adicionando o card de publicacao ao feed
                        feed.appendChild(divPublicacao);
                    }

                });
            } else {
                throw ('Houve um erro na API!');
            }
        }).catch(function (resposta) {
            console.error(resposta);
        });



        function atualizarMaquina(idComputador) {
        // Redireciona o usuário para a página de edição com o ID do funcionário como parâmetro na URL
        if (confirm("Tem a certeza de que deseja reativar esta máquina?")) {
        fetch(`/maquinas/atualizarMaquina/${idComputador}`, {
            method: "PUT"
        })
        .then(resposta => {
            if (resposta.ok) {
                alert("Máquina reativada com sucesso!");
                atualizarFeed(); // Atualiza a lista após a exclusão
            } else {
                throw "Não foi possível reaativar a maquina";
            }
        })
        .catch(error => {
            console.error(error);
            alert("Ocorreu um erro ao tentar reativar a maquina");
        });
    }
    }



        function deletar(idComputador) {
    if (confirm("Tem a certeza de que deseja desativar esta máquina?")) {
        fetch(`/maquinas/deletar/${idComputador}`, {
            method: "PUT"
        })
        .then(resposta => {
            if (resposta.ok) {
                alert("Máquina desativada com sucesso!");
                atualizarFeed(); // Atualiza a lista após a exclusão
            } else {
                throw "Não foi possível desativar a maquina";
            }
        })
        .catch(error => {
            console.error(error);
            alert("Ocorreu um erro ao tentar deletar a maquina");
        });
    }
}



    }
</script>